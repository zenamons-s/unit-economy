import{r as o,E as L,_ as k,F as p,ab as Ue,o as S,j as l,az as I,b as V,c as ve,B as M,h as ze,a0 as be,k as Ce,al as ee,bj as Ie,e as D,bX as Ee,p as Be,ac as De,ad as Le,bS as ke,bT as Ve}from"./index.DSTThs-t.js";import{u as Me}from"./FormClearHelper.CA_5b-Ut.js";import{g as oe,F as R,a as Re,D as Ae,I as Pe,s as Ne,b as Te}from"./FileHelper.Bhs-iVRI.js";import{S as qe,P as We}from"./ProgressBar.DyQNhVsJ.js";import{U as $}from"./UploadFileInfo.Dr-zDST7.js";const He=e=>{const t=o.useRef();return o.useEffect(()=>{t.current=e},[e]),t.current};var ne=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(L,k({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"}))});ne.displayName="ChevronLeft";var re=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(L,k({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"}))});re.displayName="ChevronRight";var ae=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(L,k({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"}))});ae.displayName="Clear";var le=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(L,k({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});le.displayName="CloudUpload";var se=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(L,k({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});se.displayName="Error";const ie=p("section",{target:"e7fhruq0"})(({isDisabled:e,theme:t})=>({display:"flex",gap:t.spacing.lg,alignItems:"center",padding:t.spacing.lg,backgroundColor:t.colors.secondaryBg,borderRadius:t.radii.default,border:t.colors.widgetBorderColor?`${t.sizes.borderWidth} solid ${t.colors.widgetBorderColor}`:void 0,height:t.sizes.largestElementHeight,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${t.colors.primary}`},cursor:e?"not-allowed":"pointer"})),$e=p("div",{target:"e7fhruq1"})(({theme:e})=>({marginRight:"auto",alignItems:"center",display:"flex",gap:e.spacing.lg,minWidth:0,width:"100%"})),ce=p("span",{target:"e7fhruq2"})(({theme:e})=>({color:e.colors.darkenedBgMix100})),de=p("span",{target:"e7fhruq3"})(({theme:e,disabled:t})=>({color:t?e.colors.fadedText40:e.colors.bodyText})),je=p("span",{target:"e7fhruq4"})(({theme:e,disabled:t})=>({fontSize:e.fontSizes.sm,color:t?e.colors.fadedText40:e.colors.fadedText60,display:"block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%"})),Xe=p("div",{target:"e7fhruq5"})({display:"flex",flexDirection:"column",minWidth:0,maxWidth:"100%"}),Oe=p("span",{target:"e7fhruq6"})({whiteSpace:"nowrap"}),pe=p("div",{target:"e7fhruq7"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg})),_e=p("ul",{target:"e7fhruq8"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none})),ue=p("li",{target:"e7fhruq9"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none})),ge=p("div",{target:"e7fhruq10"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"})),fe=p("div",{target:"e7fhruq11"})(({theme:e,disabled:t})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t?e.colors.fadedText40:e.colors.bodyText})),he=p("div",{target:"e7fhruq12"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS})),Ke=p("span",{target:"e7fhruq13"})(({theme:e})=>({marginRight:e.spacing.twoXS})),Ye=p("div",{target:"e7fhruq14"})(({theme:e,disabled:t})=>({display:"flex",padding:e.spacing.twoXS,color:t?e.colors.fadedText40:e.colors.darkenedBgMix100})),Fe=p("small",{target:"e7fhruq15"})(({theme:e})=>({color:e.colors.redTextColor,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"})),me=p("span",{target:"e7fhruq16"})({}),Ge=e=>({[ie]:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"auto",gap:e.spacing.sm},[ce]:{display:"none"},[de]:{marginBottom:e.spacing.twoXS},[pe]:{paddingRight:e.spacing.lg},[he]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[fe]:{width:e.sizes.full},[ge]:{flexDirection:"column"},[Fe]:{height:"auto",whiteSpace:"initial"},[me]:{display:"none"},[ue]:{margin:e.spacing.none,padding:e.spacing.none}}),Je=p("div",{target:"e7fhruq17"})(({theme:e,width:t})=>{if(t<Ue("23rem"))return Ge(e)}),Qe=({multiple:e,acceptedExtensions:t,maxSizeBytes:n,acceptDirectory:s=!1,disabled:d})=>{const x=()=>s?"directories":e?"files":"file",c=()=>t.length?` â€¢ ${t.map(y=>y.replace(/^\./,"").toUpperCase()).join(", ")}`:null,F=()=>`Limit ${oe(n,R.Byte,0)} per file`;return S($e,{"data-testid":"stFileUploaderDropzoneInstructions",children:[l(ce,{children:l(I,{content:le,size:"threeXL"})}),S(Xe,{children:[S(de,{disabled:d,children:["Drag and drop ",x()," here"]}),S(je,{disabled:d,children:[F(),c()]})]})]})},Ze=o.memo(Qe),et=({onDrop:e,multiple:t,acceptedExtensions:n,maxSizeBytes:s,disabled:d,label:x,acceptDirectory:c=!1})=>l(Ae,{onDrop:e,multiple:t,accept:Re(n),maxSize:s,disabled:d,useFsAccessApi:!1,children:({getRootProps:F,getInputProps:y})=>{const v=y({multiple:t||!!c});return S(ie,{...F(),"data-testid":"stFileUploaderDropzone",isDisabled:d,"aria-label":x,"aria-disabled":d,children:[l("input",{"data-testid":"stFileUploaderDropzoneInput",...v,...c&&{webkitdirectory:""}}),l(Ze,{multiple:t,acceptedExtensions:n,maxSizeBytes:s,acceptDirectory:c,disabled:d}),l(Oe,{children:l(V,{kind:M.SECONDARY,disabled:d,size:ve.SMALL,children:c?"Browse directories":"Browse files"})})]})}}),tt=o.memo(et),ye=p("small",{target:"e1xq3mgd0"})(({kind:e,disabled:t,theme:n})=>{const{redTextColor:s,fadedText60:d,fadedText40:x}=n.colors;let c=d;return t&&(c=x),e==="danger"&&(c=s),{color:c,fontSize:n.fontSizes.sm,lineHeight:n.lineHeights.tight}}),ot=({fileInfo:e,disabled:t})=>e.status.type==="uploading"?l(We,{value:e.status.progress,size:qe.SMALL}):e.status.type==="error"?S(Fe,{children:[l(Ke,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),l(me,{children:l(I,{content:se,size:"lg"})})]}):e.status.type==="uploaded"?l(ye,{disabled:t,children:oe(e.size,R.Byte)}):null,nt=({fileInfo:e,onDelete:t,disabled:n})=>S(he,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[l(Ye,{disabled:n,children:l(I,{content:Pe,size:"twoXL"})}),S(ge,{className:"stFileUploaderFileData",children:[l(fe,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,disabled:n,children:e.name}),l(ot,{fileInfo:e,disabled:n})]}),l("div",{"data-testid":"stFileUploaderDeleteBtn",children:l(V,{onClick:()=>t(e.id),kind:M.MINIMAL,disabled:n,"aria-label":`Remove ${e.name}`,children:l(I,{content:ae,size:"lg"})})})]}),rt=o.memo(nt),at=p("div",{target:"e1o0u1j0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS})),lt=p("div",{target:"e1o0u1j1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40})),st=({currentPage:e,totalPages:t,onNext:n,onPrevious:s})=>S(at,{"data-testid":"stFileUploaderPagination",children:[l(ye,{children:`Showing page ${e} of ${t}`}),S(lt,{children:[l(V,{onClick:s,kind:M.MINIMAL,children:l(I,{content:ne,size:"xl"})}),l(V,{onClick:n,kind:M.MINIMAL,children:l(I,{content:re,size:"xl"})})]})]}),it=o.memo(st),te=(e,t)=>Math.ceil(e.length/t),ct=e=>ze(({pageSize:n,items:s,resetOnAdd:d,...x})=>{const[c,F]=o.useState(0),[y,v]=o.useState(()=>te(s,n)),u=He(s);o.useEffect(()=>{u&&u.length!==s.length&&v(te(s,n)),u&&u.length<s.length?d&&F(0):c+1>=y&&F(y-1)},[s,c,n,u,d,y]);const E=()=>{F(Math.min(c+1,y-1))},z=()=>{F(Math.max(0,c-1))},A=s.slice(c*n,c*n+n);return S(be,{children:[l(e,{items:A,...x}),s.length>n?l(it,{pageSize:n,totalPages:y,currentPage:c+1,onNext:E,onPrevious:z}):null]})},e),dt=({items:e,onDelete:t,disabled:n})=>l(_e,{children:e.map(s=>l(ue,{children:l(rt,{fileInfo:s,onDelete:t,disabled:n})},s.id))}),pt=ct(dt),ut=e=>l(pe,{children:l(pt,{...e})}),gt=o.memo(ut),ft=(e,t)=>{const n=t.getFileUploaderStateValue(e);if(D(n))return{files:[],nextLocalId:1};const{uploadedFileInfo:s}=n;if(D(s)||s.length===0)return{files:[],nextLocalId:1};let d=1;return{files:s.map(c=>{const F=c.name,y=c.size,v=c.fileId,u=c.fileUrls,E=new $(F,y,d,{type:"uploaded",fileId:v,fileUrls:u});return d+=1,E}),nextLocalId:d}},H=e=>{const t=e.filter(n=>n.status.type==="uploaded").map(n=>{const{name:s,size:d,status:x}=n,{fileId:c,fileUrls:F}=x;return new ke({fileId:c,fileUrls:F,name:s,size:d})});return new Ve({uploadedFileInfo:t})},ht=({disabled:e,element:t,widgetMgr:n,uploadClient:s,fragmentId:d})=>{const{width:x,elementRef:c}=Ce(),{files:F,nextLocalId:y}=o.useMemo(()=>ft(t,n),[t,n]),v=o.useRef(y),[u,E]=o.useState(()=>F),z=o.useRef(u);o.useEffect(()=>{z.current=u},[u]);const[A,j]=o.useState(!1),B=o.useCallback(()=>{const r=v.current;return v.current+=1,r},[]),P=o.useMemo(()=>{const r=t.maxUploadSizeMb;return Ne(r,R.Megabyte,R.Byte)},[t.maxUploadSizeMb]),U=o.useCallback(r=>{ee.flushSync(()=>{E(a=>{const i=typeof r=="function"?r(a):r;return z.current=i,i})})},[]),N=o.useCallback(r=>{ee.flushSync(()=>{j(r)})},[j]),X=o.useCallback(r=>{U(a=>[...a,r])},[U]),T=o.useCallback(r=>{r.length!==0&&U(a=>[...a,...r])},[U]),O=o.useCallback(r=>{U(a=>a.filter(i=>i.id!==r))},[U]),b=o.useCallback((r,a)=>{U(i=>i.map(g=>g.id===r?a:g))},[U]),C=o.useCallback(r=>z.current.find(a=>a.id===r),[]),_=u.some(r=>r.status.type==="uploading")||A?"updating":"ready";o.useEffect(()=>{n.getFileUploaderStateValue(t)===void 0&&n.setFileUploaderStateValue(t,H(z.current),{fromUi:!1},d)},[n,t,d]),o.useEffect(()=>{if(_!=="ready")return;const r=H(u),a=n.getFileUploaderStateValue(t);Ie(r,a)||n.setFileUploaderStateValue(t,r,{fromUi:!0},d)},[_,u,n,t,d]);const xe=o.useCallback(()=>{U(()=>[]);const r=H([]);n.setFileUploaderStateValue(t,r,{fromUi:!0},d)},[t,d,U,n]);Me({element:t,widgetMgr:n,onFormCleared:xe});const K=o.useCallback(r=>{const a=t.type;if(!a||a.length===0)return!0;const i=r.name.toLowerCase();return a.some(g=>i.endsWith(g.toLowerCase()))},[t.type]),Y=o.useCallback(r=>{const a=[],i=[];return r.forEach(g=>{K(g)?a.push(g):i.push({file:g,errors:[{code:"file-invalid-type",message:`${g.type} files are not allowed.`}]})}),{accepted:a,rejected:i}},[K]),G=o.useCallback((r,a)=>{const i=C(r);D(i)||i.status.type!=="uploading"||b(i.id,i.setStatus({type:"uploaded",fileId:a.fileId,fileUrls:a}))},[C,b]),J=o.useCallback((r,a)=>{const i=C(a);if(D(i)||i.status.type!=="uploading")return;const g=Math.round(r.loaded*100/r.total);i.status.progress!==g&&b(a,i.setStatus({type:"uploading",abortController:i.status.abortController,progress:g}))},[C,b]),Q=o.useCallback((r,a)=>{const i=new AbortController,g=a.webkitRelativePath||a.name,f=new $(g,a.size,B(),{type:"uploading",abortController:i,progress:1});X(f),s.uploadFile(t,r.uploadUrl,a,h=>J(h,f.id),i.signal).then(()=>G(f.id,r)).catch(h=>{h instanceof DOMException&&h.name==="AbortError"||b(f.id,f.setStatus({type:"error",errorMessage:h?h.toString():"Unknown error"}))})},[X,t,B,G,J,b,s]),q=o.useCallback(r=>{if(e)return;const a=C(r);D(a)||(a.status.type==="uploading"&&a.status.abortController.abort(),a.status.type==="uploaded"&&a.status.fileUrls.deleteUrl&&s.deleteFile(a.status.fileUrls.deleteUrl),O(r))},[e,C,O,s]),Se=o.useCallback((r,a)=>{const{multipleFiles:i}=t,g=!!t.acceptDirectory;let f=[...r],h=[...a];if(g&&f.length>0){const{accepted:w,rejected:m}=Y(f);f=w,h=[...h,...m]}if(!i&&f.length===0&&h.length>1){const w=h.findIndex(m=>m.errors.length===1&&m.errors[0].code==="too-many-files");w>=0&&(f.push(h[w].file),h.splice(w,1))}if(s.fetchFileURLs(f).then(w=>{if(!i&&f.length>0){const m=z.current.find(W=>W.status.type!=="error");if(m){N(!0);try{q(m.id)}finally{N(!1)}}}Ee(w,f).forEach(([m,W])=>{Q(m,W)})}).catch(w=>{T(f.map(m=>new $(m.name,m.size,B(),{type:"error",errorMessage:w})))}),h.length>0){const w=h.map(m=>Te(m,B(),P));T(w)}},[T,q,t,Y,P,B,s,Q,N]),Z=o.useMemo(()=>u.slice().reverse(),[u]),we=t.type;return S(Je,{className:"stFileUploader","data-testid":"stFileUploader",width:x,ref:c,children:[l(Le,{label:t.label,disabled:e,labelVisibility:Be(t.labelVisibility?.value),children:t.help&&l(De,{content:t.help,label:t.label})}),l(tt,{onDrop:Se,multiple:t.multipleFiles,acceptedExtensions:we,maxSizeBytes:P,label:t.label,disabled:e,acceptDirectory:!!t.acceptDirectory}),Z.length>0&&l(gt,{items:Z,pageSize:3,onDelete:q,resetOnAdd:!0,disabled:e})]})},wt=o.memo(ht);export{wt as default};
